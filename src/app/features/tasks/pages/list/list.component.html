<div class="card">
  <p-toolbar styleClass="mb-4">
    <ng-template pTemplate="left">
      <h3 class="m-0">Tareas</h3>
    </ng-template>
    <ng-template pTemplate="right">
      <p-dropdown 
        [options]="statusOptions" 
        [(ngModel)]="selectedStatus" 
        (onChange)="filterByStatus()"
        placeholder="Filtrar por estado"
        styleClass="mr-2">
      </p-dropdown>
      <p-button 
        label="Nueva Tarea" 
        icon="pi pi-plus" 
        (onClick)="createNew()">
      </p-button>
    </ng-template>
  </p-toolbar>

  <p-table 
    [value]="tasks" 
    [rows]="rows"
    [paginator]="true"
    [totalRecords]="totalRecords"
    [loading]="loading"
    [lazy]="true"
    (onLazyLoad)="onPageChange($event)"
    [first]="first"
    responsiveLayout="scroll"
    styleClass="p-datatable-gridlines">
    
    <ng-template pTemplate="header">
      <tr>
        <th>Código</th>
        <th>Título</th>
        <th>Fecha Límite</th>
        <th>Intentos Máx.</th>
        <th>Punt. Mín. Aprobación</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-task>
      <tr>
        <td>{{ task.code }}</td>
        <td>{{ task.title }}</td>
        <td>{{ task.dueDate | date:'dd/MM/yyyy' }}</td>
        <td>{{ task.maxAttempts }}</td>
        <td>{{ task.minScoreToPass }}</td>
        <td>
          <p-tag 
            [value]="getStatusLabel(task.status)" 
            [severity]="getStatusSeverity(task.status)">
          </p-tag>
        </td>
        <td>
          <div class="flex gap-2">
            <p-button 
              icon="pi pi-pencil" 
              styleClass="p-button-rounded p-button-text p-button-warning"
              (onClick)="edit(task)"
              pTooltip="Editar"
              tooltipPosition="top">
            </p-button>
            <p-button 
              *ngIf="task.status === 'ENABLED'"
              icon="pi pi-times" 
              styleClass="p-button-rounded p-button-text p-button-danger"
              (onClick)="disable(task)"
              pTooltip="Deshabilitar"
              tooltipPosition="top">
            </p-button>
            <p-button 
              *ngIf="task.status === 'DISABLED'"
              icon="pi pi-check" 
              styleClass="p-button-rounded p-button-text p-button-success"
              (onClick)="enable(task)"
              pTooltip="Habilitar"
              tooltipPosition="top">
            </p-button>
          </div>
        </td>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" class="text-center">
          <div class="p-4">
            <i class="pi pi-info-circle text-4xl text-400"></i>
            <p class="text-500 mt-3">No se encontraron tareas</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-confirmDialog></p-confirmDialog>
